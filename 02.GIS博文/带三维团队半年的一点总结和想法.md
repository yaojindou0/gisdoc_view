- [带三维团队半年的一点总结和想法](https://www.cnblogs.com/naaoveGIS/p/9397727.html)

## 1.  一个有些突然的人事变动

​      公司二维团队和三维团队由于历史原因，分别属于不同的部门，两者之间关联甚少。二维团队与公司业务紧密联系，三维团队相对独立、偏向平台的开发和市政业务的结合。但是随着公司业务的不断扩展，前端展示需求的深入，以及二三维一体化的趋势越来越流行，公司产品上的二三位一体化在去年也提上了议程。

​     在去年年末时公司进行了人事调整，由我来接管原来的三维团队以及移动GIS运用，成立独立的GIS部门。当时一方面是充满信心，另一方面也由于对三维产品了解甚少，个人也是倍感压力。年终汇报时，给领导做了一个演讲，题目是我心中的大GIS部门：

 ![img](https://images2018.cnblogs.com/blog/656746/201808/656746-20180801160912374-938789488.png)

## 2.  尴尬的现实

​    二三位一体化老板给了很高的期许，一是希望公司的所有产品地图部分均可以无缝切换，而是希望三维在展示特效上可以跨越式发展。领导举了不少例子，比如数字冰雹，比如腾讯云的三维等。

 ![img](https://images2018.cnblogs.com/blog/656746/201807/656746-20180731190218546-1880306370.png)

​     现实是，在接手三维后不到一个月，原来的三维团队负责人离职，剩下的几个均是刚来公司不到一年的新人。在四五年前，公司的三维团队有近十个人，都是武大硕士，这几年下来反而人员流失严重，不少又回学校读博士，其实这也可以看出，三维的市场行情和我们想象的是有偏差的，而去年更是听说三维的龙头之一伟景行被收购。

​    当时对公司三维的现状做了总结：人少、产品线多、业务需求不明确。于是我个人决定，三维团队对C/S平台仅处于维护状态，全力投入已有的Web平台开发中，重点进行功能需求的覆盖和特效展示的研究。

## 3.  步子不能太大，但是更不能不迈步子

​    在跟团队开会统一好目标后，便详细的进行了功能点的罗列。

​    优先级别为：

​    a.优先保证项目，完成成熟产品已有功能的二三维一体化切换。

​    b.其次丰富产品基本功能。                

​    c.最后研究产品的特效展示。

### 3.1项目是团队立足之点

​    公司的是一个靠项目赚钱的公司，判断一个团队是否有价值，能够有多少人，最直接的考核就是产出比。所以无论我们有多少想法，首先要保证的还是项目可以正常进展。而项目和产品也是不冲突的。这里我总结了三个原则：

​    a.在项目中完成的功能，我们可以封装到主版本中，让其他项目可以共用。

​    b.作为平台，我们要完成向下兼容，新增和扩展的功能不能影响老功能使用。

​    c.如果遇到十分定制化需求，尽量拆分模块直至将完全定制化代码隔离，通过接口参数或服务配置控制是否开启，核心目标是统一版本，不做分支维护。

​    在项目的支持中，团队先后完成了热力、聚类、空间分析、轨迹展示、统计图表展示等可以提交至平台的功能，以及二维展示和三维展示同步需求，覆盖了顺义、宁波、益阳等项目的二三维一体化。

![img](https://images2018.cnblogs.com/blog/656746/201807/656746-20180731190302042-147917221.png) 

 ![img](https://images2018.cnblogs.com/blog/656746/201807/656746-20180731190312956-930656466.png)         

 ![img](https://images2018.cnblogs.com/blog/656746/201807/656746-20180731190332904-221183728.png)

![img](https://images2018.cnblogs.com/blog/656746/201807/656746-20180731190410063-1534227246.jpg)

​    其实项目所需的功能点在cesium中基本都已经有比较成熟的封装类和方法。实现起来既能看到效果，又能满足需求，而且实现难度不高，这也是我让团队优先进行完成的原因。

### 3.2完善产品的基本功能

​    工欲善其事必先利其器，在项目没有明确提出需求前，我们可以通过分析竞品，以及根据二维功能经验和三维CS平台经验，对三维web产品进行丰富完善。在这半年，先后推动或优化了三维量测功能、管线挖方功能、地表透明、动态水域、视域分析功能等。

 ![img](https://images2018.cnblogs.com/blog/656746/201807/656746-20180731190433992-726109770.png)

![img](https://images2018.cnblogs.com/blog/656746/201807/656746-20180731190445554-1204901220.png) 

 ![img](https://images2018.cnblogs.com/blog/656746/201807/656746-20180731190502550-2110605925.png)

 ![img](https://images2018.cnblogs.com/blog/656746/201807/656746-20180731190528349-1015466270.png)

​    这里最值得让我想给他们点赞的一件事，就是团队终于完成了对视频任意投射的支持。这个功能是进行shader编程实现，偏底层。目标是让摄像头的视频可以投射到三维模型上，实现场景的流动。

 ![img](https://images2018.cnblogs.com/blog/656746/201807/656746-20180731190549690-1614316516.png)

### 3.3特效展示的研究——认清现实

​     三维的特效展示，主要的用武之地是大屏幕展示。之前提到过的数字冰雹公司，后来一个同事有机会和他们的研发进行了接触，了解到现在他们做的大屏展示采用的是离屏渲染技术。即一台高性能机器作为渲染服务器专门做渲染出图，前端的大屏幕仅仅是投屏展示，其实采用的就是CS架构。而这与公司的人力现状是无法匹配的，公司的人力只能支撑一条三维产品线，这个产品线不能是CS的，否则业务端的各类产品将无法与三维集成（不考虑ActiveX，前端布局局限太多，而且只能是IE）。

​    所以，我们只能立足现在的产品架构力求做一些可以发力的点：

​    a.灰模展示特效

​    b.多轨迹展示特效

​    c.粒子效果

​     这其中，我一直重点推动的是灰模展示特效。其最主要原因在于，大多数项目其实是没有三维模型数据的，如果我们能够通过二维建筑物图层拉伸出效果足够好的三维展示方式，那么二三维一体化的推广将容易很多。所以针对灰模特效，我一直在不断推动。从最开始建筑物高高低低如何看起来不杂乱、赋色、发光、加上路网让其丰富等，到现在基本初具效果。

 ![img](https://images2018.cnblogs.com/blog/656746/201807/656746-20180731190611648-660688378.png)

 ![img](https://images2018.cnblogs.com/blog/656746/201807/656746-20180731190626573-2051768319.png)

## 4.  一些规划和感想

### 4.1如何破解二三维一体化的快速落地？——一个矛盾的问题

​    我们研究灰模特效，我们预先下载好全国的经纬度坐标系地图瓦片等等，均是为了尽量减少三维展示对业主需要提供的数据依赖。但是现在在我看来，这还不是推动落地的最核心问题，最核心问题是，三维展示有太多不确定的地方，即坑多人少。

​    比如，二维中轨迹即使不在路上也不影响展示效果，但是三维展示中轨迹穿墙则十分影响感官。再比如，如果贸然放开了合同上没有提及的三维模块，引起业主反复对三维提需求，则人力如何平衡？

　　这不仅仅是技术问题，还是一个回报成本问题。所以现在的选择是：

​    a.有三维的合同才上三维

​    b.二三维一体化的重点是大屏展示，即使合同没有提到三维，也可以作为试点先上

​    c.业务平台上只满足基本的二三维展示切换。一些不重要功能或针对二维的功能，不需要三维完全覆盖。

### 4.2平台还有哪些坑？

​    其实平台最核心的问题反而不是展示，而是数据处理的优化，以及展示效率的提升，而这些反而是难度最高的。

​     举个例子，同样是展示十万个建筑物灰模，超图的web三维平台就比我们的要快不少。而据了解，超图是定义了自己的三维数据格式。另外，我们的桌面平台工具虽然可以支持将精模数据以及倾斜摄影数据处理成3dtiles，但是需要的处理步骤很繁琐，网上的一些目前开源的工具都比我们方便，但是这些工具都有收费的趋势，所以我们自身的工具还要优化。

​    最后，希望三维产品可以在大屏展示上真正落地，同时开始推动与移动端的GIS平台进行二三维一体化整合。