- [（二）城市三维基础展示方案](https://www.cnblogs.com/naaoveGIS/p/11164062.html)

# 1. 数据准备

所需基础数据与之前讨论过的方案1一致，需要提供政边界、水系、建筑物（必须带楼层属性）、道路、绿地等图层数据。针对三维模型，支持精模和灰模方案。

# 2. 展示方案特色

该方案将重点突出行政区内数据，并通过一系列优化，让深色星河融入场景，场景内各要素自然类流动，配合动态变化的图表仪盘，更添科技酷炫感。

# 3. 具体展示描述

## 3.1突出行政立体边界

将外框行政边界处理成json格式，按照立体光晕效果绘制在球体上。

 ![img](https://img2018.cnblogs.com/blog/656746/201907/656746-20190710152546662-1939468882.png)

## 3.2三维球体透明

球体最大的好处是对全球尺度，或者大范围面积的展示。但是项目往往只是一个相对小的区域，用球体展示方案不可避免的需要加载使用很多范围外的数据，必然需要使用到互联网环境，这限制了项目的环境兼容性。

当把球体透明后，所需展示数据则只需要本区域内的数据，并且让该区域呈现出一种悬空的特效，配合深色的星空盒子，符合目前的展示科技风。

## 3.3限制三维球体缩放范围

当三维球透明后，大范围中已经没有数据，此时再让三维球任意缩放是不合理的，并且容易出现缩放太小后找不到数据所在的问题。这里，还需要限制三维球的缩放范围，使其缩放范围刚好在数据范围内。

## 3.4外边界延伸配图

但是如果仅仅只有行政范围内的一些数据，在行政范围较小时，投放到大屏幕上容易出现中间外框空洞感。尤其目前透明球体后，有如星空下一个小岛。所以三维配图方案也要做出改变，及外边界延伸配图。将范围外的一些路网、大区域行政边界进行弱化配图。

 ![img](https://img2018.cnblogs.com/blog/656746/201907/656746-20190710145108583-898211127.png)

## 3.5地图底图调度优化及缓存

默认的三维场景中，模型加载的顺序是先于地图底图瓦片的加载顺序的，这会导致，当模型加载完后底图再请求加载，给人一种场景卡顿的感觉。

这里我们需要做两个优化：

1. 调整地图底图和模型的加载顺序，让底图优先加载，模型再依次叠加。使用户首先就能看到场景全貌后，再陆续通过模型增加来丰富细节。
2. 让底图瓦片走nginx转发，在nginx中增加瓦片缓存机制。一次在线请求缓存后，地图第二次加载将会迅速不少。

## 3.6增加粒子特效

在场景中增加一些缓慢、动态的向星空上升的粒子，以表示整个城市的信息流动向。

 ![img](https://img2018.cnblogs.com/blog/656746/201907/656746-20190710145122378-1568177291.png)

# 4. 整体展示效果

在该场景中增加迁徙图效果、定位图标、热力后的整体展示如下：

 ![img](https://img2018.cnblogs.com/blog/656746/201907/656746-20190710152257754-1500074480.gif)