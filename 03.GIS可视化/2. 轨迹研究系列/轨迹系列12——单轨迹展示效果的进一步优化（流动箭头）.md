- [轨迹系列12——单轨迹展示效果的进一步优化（流动箭头）](https://www.cnblogs.com/naaoveGIS/p/9305685.html)

## 1.  背景

在PC端展示轨迹的探索中，我们分别针对轨迹纠正、单轨迹播放、多轨迹播放做了研究和实现。其核心抓手便是轨迹的美观、数据的动态。而除了对监控点实现播放以达到数据的动态展示外，我们还可以从表示轨迹方向的箭头入手，将其优化为流动的效果以实现轨迹的动态。这一点可以参考易到用车。

## 2.箭头描绘的实现（字体方案）

以下为滴滴打车的轨迹描绘：

 ![img](https://images2018.cnblogs.com/blog/656746/201807/656746-20180713161723589-1833722871.png)

在前面的博客中《[WebGIS中使用ZRender实现轨迹前端动态播放特效](https://www.cnblogs.com/naaoveGIS/p/6718822.html)》（http://www.cnblogs.com/naaoveGIS/p/6718822.html），我提到了通过数学公式以固定距离构造箭头的各坐标点以实现轨迹箭头描绘的方案。

但是该方案对于数学要求相对较高，这里给出另外一种方案来实现箭头的描绘。

a.在图标网站上选择需要的箭头样式。

 ![img](https://images2018.cnblogs.com/blog/656746/201807/656746-20180713161740161-348765637.png)

 b.将箭头图标导出生成为字体库

 ![img](https://images2018.cnblogs.com/blog/656746/201807/656746-20180713161753919-116158619.png)

c.前端将该字体库引入

 ![img](https://images2018.cnblogs.com/blog/656746/201807/656746-20180713161812429-1813421302.png)

d.组织绘制箭头对应的样式

 ![img](https://images2018.cnblogs.com/blog/656746/201807/656746-20180713161819980-358906224.png)

## 3.箭头流动的实现

 该效果需要完成如下几个功能点：

 a.无论线路方向如何，线段之间的箭头是等距离

 b.箭头匀速移动

 c.箭头为循环播放

### 3.1 定时刷新要素重绘机制

 目前采用的OpenLayers来进行H5地图开发，OL中可以通过注册地图渲染事件，实现每一次渲染结束时触发对应函数。

![img](https://images2018.cnblogs.com/blog/656746/201807/656746-20180713161854741-186281348.png)

 进入到对应的postCompose函数内部后，再通过timer来控制下一次绘制的触发。

 ![img](https://images2018.cnblogs.com/blog/656746/201807/656746-20180713161839730-139146431.png)

### 3.2箭头重绘函数实现

其中涉及到一定的平面几何，主要集中在箭头等距的计算，箭头移动的计算以及箭头的循环播放计算上。这里直接贴出对应代码：

 ![img](https://images2018.cnblogs.com/blog/656746/201807/656746-20180713161918129-626164168.png)

## 4.效果展示

​             ![img](https://images2018.cnblogs.com/blog/656746/201807/656746-20180713161937485-24111702.gif)

 